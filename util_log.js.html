

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: util/log.js | yeoman-environment</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 127px; height: 14px">
        
            <img src="https://raw.githubusercontent.com/yeoman/yeoman.github.io/source/app/assets/img/logo.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">yeoman-environment</a></h1>
        
            <span class="version">v2.7.0</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Modules</h3><ul><li><a href="module-env_log.html">env/log</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:env/log_sub"></div></li><li><a href="module-env_util.html">env/util</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:env/util_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-env_util.html#.log">log</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-env_util.html#.duplicateEnv">duplicateEnv</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Environment.html">Environment</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Environment_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Environment.html#.util">util</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Environment.html#.createEnv">createEnv</a></li><li><a href="Environment.html#.enforceUpdate">enforceUpdate</a></li><li><a href="Environment.html#.lookupGenerator">lookupGenerator</a></li><li><a href="Environment.html#.namespaceToName">namespaceToName</a></li><li><a href="Environment.html#alias">alias</a></li><li><a href="Environment.html#alias">alias</a></li><li><a href="Environment.html#create">create</a></li><li><a href="Environment.html#error">error</a></li><li><a href="Environment.html#findGeneratorsIn">findGeneratorsIn</a></li><li><a href="Environment.html#findGeneratorsIn">findGeneratorsIn</a></li><li><a href="Environment.html#get">get</a></li><li><a href="Environment.html#getByPath">getByPath</a></li><li><a href="Environment.html#getGeneratorNames">getGeneratorNames</a></li><li><a href="Environment.html#getGeneratorsMeta">getGeneratorsMeta</a></li><li><a href="Environment.html#getNpmPaths">getNpmPaths</a></li><li><a href="Environment.html#getNpmPaths">getNpmPaths</a></li><li><a href="Environment.html#getPackagePath">getPackagePath</a></li><li><a href="Environment.html#getPackagePaths">getPackagePaths</a></li><li><a href="Environment.html#getRegisteredPackages">getRegisteredPackages</a></li><li><a href="Environment.html#help">help</a></li><li><a href="Environment.html#instantiate">instantiate</a></li><li><a href="Environment.html#isPackageRegistered">isPackageRegistered</a></li><li><a href="Environment.html#lookup">lookup</a></li><li><a href="Environment.html#lookup">lookup</a></li><li><a href="Environment.html#namespace">namespace</a></li><li><a href="Environment.html#namespaces">namespaces</a></li><li><a href="Environment.html#register">register</a></li><li><a href="Environment.html#registerStub">registerStub</a></li><li><a href="Environment.html#resolveModulePath">resolveModulePath</a></li><li><a href="Environment.html#run">run</a></li><li><a href="Environment.html#runGenerator">runGenerator</a></li></ul></div></li><li><a href="TerminalAdapter.html">TerminalAdapter</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TerminalAdapter_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TerminalAdapter.html#log">log</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TerminalAdapter.html#diff">diff</a></li><li><a href="TerminalAdapter.html#prompt">prompt</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Mixins</h3><ul><li><a href="env_resolver.html">env/resolver</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="env/resolver_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="env_resolver.html#.alias">alias</a></li><li><a href="env_resolver.html#.findGeneratorsIn">findGeneratorsIn</a></li><li><a href="env_resolver.html#.getNpmPaths">getNpmPaths</a></li><li><a href="env_resolver.html#.lookup">lookup</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li><a href="global.html#callbackWrapper">callbackWrapper</a></li><li><a href="global.html#getGeneratorHint">getGeneratorHint</a></li><li><a href="global.html#splitArgsFromString">splitArgsFromString</a></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module env/log */
'use strict';
const util = require('util');
const EventEmitter = require('events');
const _ = require('lodash');
const table = require('text-table');
const chalk = require('chalk');
const logSymbols = require('log-symbols');

// Padding step
const step = '  ';
let padding = ' ';

function pad(status) {
  const max = 'identical'.length;
  const delta = max - status.length;
  return delta ? ' '.repeat(delta) + status : status;
}

// Borrowed from https://github.com/mikeal/logref/blob/master/main.js#L6-15
function formatter(msg, ctx) {
  while (msg.indexOf('%') !== -1) {
    const start = msg.indexOf('%');
    let end = msg.indexOf(' ', start);

    if (end === -1) {
      end = msg.length;
    }

    msg = msg.slice(0, start) + ctx[msg.slice(start + 1, end)] + msg.slice(end);
  }

  return msg;
}

const getDefaultColors = () => ({
  skip: 'yellow',
  force: 'yellow',
  create: 'green',
  invoke: 'bold',
  conflict: 'red',
  identical: 'cyan',
  info: 'gray'
});

const initParams = params => {
  params = params || {};
  return Object.assign(
    {}, params, {
      colors: Object.assign(getDefaultColors(), params.colors || {})});
};

module.exports = params => {
  // `this.log` is a [logref](https://github.com/mikeal/logref)
  // compatible logger, with an enhanced API.
  //
  // It also has EventEmitter like capabilities, so you can call on / emit
  // on it, namely used to increase or decrease the padding.
  //
  // All logs are done against STDERR, letting you stdout for meaningfull
  // value and redirection, should you need to generate output this way.
  //
  // Log functions take two arguments, a message and a context. For any
  // other kind of paramters, `console.error` is used, so all of the
  // console format string goodies you're used to work fine.
  //
  // - msg      - The message to show up
  // - context  - The optional context to escape the message against
  //
  // @param {Object} params
  // @param {Object} params.colors status mappings
  //
  // Returns the logger
  function log(msg, ctx) {
    msg = msg || '';

    if (typeof ctx === 'object' &amp;&amp; !Array.isArray(ctx)) {
      console.error(formatter(msg, ctx));
    } else {
      console.error.apply(console, arguments);
    }

    return log;
  }

  _.extend(log, EventEmitter.prototype);

  params = initParams(params);

  // A simple write method, with formatted message.
  //
  // Returns the logger
  log.write = function () {
    process.stderr.write(util.format.apply(util, arguments));
    return this;
  };

  // Same as `log.write()` but automatically appends a `\n` at the end
  // of the message.
  log.writeln = function () {
    this.write.apply(this, arguments);
    this.write('\n');
    return this;
  };

  // Convenience helper to write sucess status, this simply prepends the
  // message with a gren `âœ”`.
  log.ok = function () {
    this.write(logSymbols.success + ' ' + util.format.apply(util, arguments) + '\n');
    return this;
  };

  log.error = function () {
    this.write(logSymbols.error + ' ' + util.format.apply(util, arguments) + '\n');
    return this;
  };

  log.on('up', () => {
    padding += step;
  });

  log.on('down', () => {
    padding = padding.replace(step, '');
  });

  /* eslint-disable no-loop-func */
  // TODO: Fix this ESLint warning
  for (const status of Object.keys(params.colors)) {
    // Each predefined status has its logging method utility, handling
    // status color and padding before the usual `.write()`
    //
    // Example
    //
    //    this.log
    //      .write()
    //      .info('Doing something')
    //      .force('Forcing filepath %s, 'some path')
    //      .conflict('on %s' 'model.js')
    //      .write()
    //      .ok('This is ok');
    //
    // The list of default status and mapping colors
    //
    //    skip       yellow
    //    force      yellow
    //    create     green
    //    invoke     bold
    //    conflict   red
    //    identical  cyan
    //    info       grey
    //
    // Returns the logger
    log[status] = function () {
      const color = params.colors[status];
      this.write(chalk[color](pad(status))).write(padding);
      this.write(util.format.apply(util, arguments) + '\n');
      return this;
    };
  }
  /* eslint-enable no-loop-func */

  // A basic wrapper around `cli-table` package, resetting any single
  // char to empty strings, this is used for aligning options and
  // arguments without too much Math on our side.
  //
  // - opts - A list of rows or an Hash of options to pass through cli
  //          table.
  //
  // Returns the table reprensetation
  log.table = opts => {
    const tableData = [];

    opts = Array.isArray(opts) ? {rows: opts} : opts;
    opts.rows = opts.rows || [];

    for (const row of opts.rows) {
      tableData.push(row);
    }

    return table(tableData);
  };

  return log;
};
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://raw.githubusercontent.com/yeoman/yeoman.github.io/source/app/assets/img/logo.png" style="width: 127px; height: 14px">
    <div class="footer-text">BSD license Copyright (c) Google</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
